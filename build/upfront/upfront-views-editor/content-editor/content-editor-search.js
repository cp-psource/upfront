!function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;upfrontrjs.define(["text!upfront/templates/popup.html","scripts/upfront/upfront-views-editor/fields"],function(e,n){return Backbone.View.extend({id:"upfront-entity_list-search",searchTpl:_.template(t(e).find("#upfront-filter-tpl").html()),events:{"click #upfront-search_action":"handle_search_request","click #upfront-search_container button":"clear_search","click .upfront-search-results-header button":"clear_search","keydown #upfront-list-search_input":"dispatch_search_enter"},initialize:function(t){this.postType=t.postType},render:function(){var t=!!this.collection.lastFetchOptions&&this.collection.lastFetchOptions.search,e=this.get_placeholder();this.$el.html(this.searchTpl({query:t,placeholder:e})),this.add_filter_dropdowns()},get_placeholder:function(){return"post"===this.postType?Upfront.Settings.l10n.global.content.search_posts:"page"===this.postType?Upfront.Settings.l10n.global.content.search_pages:Upfront.Settings.l10n.global.content.search_cpts},dispatch_search_enter:function(t){if(13==t.which)return this.handle_search_request(t)},handle_search_request:function(t){t.preventDefault();var e=this.$el.find("#upfront-search_container input").val();this.toggle_search_class(e),this.collection.fetch({search:e})},handle_filter_request:function(){var t=this.status?this.status:"any",e=!!this.date&&this.date,n=!!this.category&&this.category,s=this.post_type&&"any"!==this.post_type?this.post_type:this.postType;this.collection.fetch({post_status:t,m:e,cat:n,postType:s}),this.toggle_search_class("")},toggle_search_class:function(t){""===t?this.$el.parent().removeClass("upfront-popup-content-search-ran"):this.$el.parent().addClass("upfront-popup-content-search-ran")},update_search_header:function(t){this.$el.find(".upfront-search-results-header #upfront-search-results-count").html()},clear_search:function(t){return t.preventDefault(),this.$el.find("#upfront-search_container input").val(""),this.toggle_search_class(""),"page"===this.collection.postType?this.collection.fetch({search:"",hierarchical:!0}):this.collection.fetch({search:""})},get_status_values:function(t){return _.mapObject(t,function(t){return void 0===t.value&&(t.value=t.name),t})},get_pt_values:function(t){return t},get_date_values:function(t){return t},get_category_values:function(t){return _.mapObject(t,function(t){return void 0===t.value&&(t.value=t.term_id),void 0===t.label&&(t.label=t.name),t})},add_filter_dropdowns:function(){var e=this,n=this.collection.filtering;return t(e.el).find("#upfront-list-filter-dropdowns-container").empty(),"post"===e.postType||"page"===e.postType?e.normal_filter_dropdowns(n):e.cpt_filter_dropdowns(n)},normal_filter_dropdowns:function(t){var e=this,s=e.collection.lastFetchOptions,r=s.post_status?s.post_status:"any",o=!!s.m&&s.m,a=!!s.cat&&s.cat,l=new n.Select({model:e.model,name:"upfront_post_status_filter",default_value:r||"any",values:e.get_status_values(t.statuses),change:function(t){e.status=t,e.handle_filter_request()}}),i=new n.Select({model:e.model,name:"upfront_post_date_filter",default_value:o||0,values:e.get_date_values(t.dates),change:function(t){e.date=t,e.handle_filter_request()}}),c=new n.Select({model:e.model,name:"upfront_post_category_filter",default_value:a||0,values:e.get_category_values(t.categories),change:function(t){e.category=t,e.handle_filter_request()}});e.filter_dropdowns=[l,i,c],l.render(),i.render(),c.render(),e.$el.find("#upfront-list-filter-dropdowns-container").append(l.$el),e.$el.find("#upfront-list-filter-dropdowns-container").append(i.$el),e.$el.find("#upfront-list-filter-dropdowns-container").append(c.$el)},cpt_filter_dropdowns:function(t){var e=this,s=e.collection.lastFetchOptions,r=s.postType&&"object"!=typeof s.postType?s.postType:"any",o=!!s.m&&s.m,a=new n.Select({model:e.model,name:"upfront_post_types_filter",default_value:r||"any",values:e.get_pt_values(t.post_types),change:function(t){e.post_type=t,e.handle_filter_request()}}),l=new n.Select({model:e.model,name:"upfront_post_date_filter",default_value:o||0,values:e.get_date_values(t.dates),change:function(t){e.date=t,e.handle_filter_request()}});e.filter_dropdowns=[a,l],a.render(),l.render(),e.$el.find("#upfront-list-filter-dropdowns-container").append(a.$el),e.$el.find("#upfront-list-filter-dropdowns-container").append(l.$el)}})})}(jQuery);