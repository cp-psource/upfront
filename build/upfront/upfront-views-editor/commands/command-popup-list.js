!function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;upfrontrjs.define(["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/content-editor"],function(o,n){return n.SidebarCommand.extend({tagName:"li",className:"command-popup-list",$popup:{},views:{},currentPanel:!1,render:function(){this.$el.addClass("upfront-entity_list upfront-icon upfront-icon-browse"),this.$el.html('<a title="'+e.posts_pages+'">'+e.posts_pages+"</a>")},on_click:function(){var o=this,n="",p=Upfront.Popup.open(function(n,p,s){var a=t(this);a.empty().append('<p class="upfront-popup-placeholder">'+e.popup_preloader+"</p>"),o.$popup={top:p,content:a,bottom:s}});o.$popup.top.parent().addClass("upfront-popup-posts");var s=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;s&&Upfront.data.posts&&Upfront.data.posts.length&&(!(!Upfront.data.posts[s]||!Upfront.data.posts[s].get)&&parseInt(Upfront.data.posts[s].get("comment_count"),10)),void 0!==Upfront.mainData.content_settings.post_types&&Upfront.mainData.content_settings.post_types.length>3&&(n='<li data-type="cpts">'+e.cpts+"</li>"),o.$popup.top.html('<ul class="upfront-tabs"><li data-type="posts" class="active">'+e.posts+'</li><li data-type="pages">'+e.pages+"</li>"+n+"</ul>"+o.$popup.top.html()+'<div class="upfront-icon upfront-icon-popup-search"></div>').find(".upfront-tabs li").on("click",function(){o.dispatch_panel_creation(this)}),o.$popup.top.find(".upfront-icon-popup-search").click(o.toggle_filter),o.dispatch_panel_creation(),p.done(function(){Upfront.Events.off("upfront:posts:sort"),Upfront.Events.off("upfront:posts:post:expand"),Upfront.Events.off("upfront:pages:sort"),Upfront.Events.off("upfront:comments:sort")})},toggle_filter:function(e){var o=t(e.target).parents(".upfront-popup-posts").find("#upfront-entity_list-search"),n=o.parent();return"none"===o.css("display")?(t(e.target).addClass("upfront-popup-icon-search-open"),n.addClass("upfront-filter-panel-open"),o.slideToggle("fast")):(t(e.target).removeClass("upfront-popup-icon-search-open"),n.removeClass("upfront-filter-panel-open"),o.slideToggle("fast"))},hide_filter_panel:function(){var e=t("#upfront-entity_list-search");e.parent().removeClass("upfront-filter-panel-open"),t(".upfront-popup-icon-search-open").removeClass("upfront-popup-icon-search-open"),e.hide(),t(".upfront-popup-content-search-ran").removeClass("upfront-popup-content-search-ran")},dispatch_panel_creation:function(o){var p=this,s=o?t(o):p.$popup.top.find(".upfront-tabs li.active"),a=s.attr("data-type"),i=(a.charAt(0).toUpperCase(),a.slice(1).toLowerCase(),!1),r=(this.post.id,{});if(p.$popup.top.find(".upfront-tabs li").removeClass("active"),s.addClass("active"),this.hide_filter_panel(),this.currentPanel=a,p.views[a]&&"pages"!=a&&"posts"!=a&&("comments"!=a||Upfront.data.currentPost&&Upfront.data.currentPost.id&&p.views[a].view.collection.postId==Upfront.data.currentPost.id))return this.render_panel(p.views[a]);if("posts"==a)i=new Upfront.Collections.PostList([],{postType:"post"}),i.orderby="post_date",r={filterContent:!0,withAuthor:!0,limit:25,post_status:"any"};else if("pages"==a)i=new Upfront.Collections.PostList([],{postType:"page"}),r={limit:25,hierarchical:!0};else if("cpts"==a){var l=Upfront.mainData.content_settings.post_types,c=[];l.map(function(t){var e=t.name;"attachment"!==e&&"post"!==e&&"page"!==e&&c.push(e)}),i=new Upfront.Collections.PostList([],{postType:c}),i.orderby="post_date",r={limit:25,withThumbnail:!0}}else{var u=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;i=new Upfront.Collections.CommentList([],{postId:u}),i.orderby="comment_date"}return i.fetch(r).done(function(t){var o,s;switch(a){case"posts":if(o=null,void 0!==p.views[a]&&(o=p.views[a].view.collection.pagination.totalElements),s=i.pagination.totalElements,o==s)return p.render_panel(p.views[a]);i.on("reset sort",p.render_panel,p),views={view:new n.Posts({collection:i,$popup:p.$popup}),search:new n.Search({collection:i,postType:"post"}),pagination:new n.Pagination({collection:i,postType:e.posts})},p.views.posts=views;break;case"pages":if(o=null,void 0!==p.views[a]&&(o=p.views[a].view.collection.pagination.totalElements),s=i.pagination.totalElements,o==s)return p.render_panel(p.views[a]);i.on("reset sort",p.render_panel,p),views={view:new n.Pages({collection:i,$popup:p.$popup}),search:new n.Search({collection:i,postType:"page"}),pagination:new n.Pagination({collection:i,postType:e.pages})},p.views.pages=views;break;case"comments":i.on("reset sort",p.render_panel,p),views={view:new n.Comments({collection:i,$popup:p.$popup}),search:new n.Search({collection:i}),pagination:new n.Pagination({collection:i})},p.views.comments=views;break;case"cpts":if(o=null,void 0!==p.views[a]&&(o=p.views[a].view.collection.pagination.totalElements),s=i.pagination.totalElements,o==s)return p.render_panel(p.views[a]);i.on("reset sort",p.render_panel,p),views={view:new n.Cpt({collection:i,$popup:p.$popup}),search:new n.Search({collection:i,postType:c}),pagination:new n.Pagination({collection:i,postType:e.cpts})},p.views.cpts=views}p.render_panel()}),!1},render_panel:function(){var t=this,e=this.views[this.currentPanel];e.view.render(),t.$popup.content.html(e.view.$el),e.view.setElement(e.view.$el),e.search.render(),t.$popup.content.prepend(e.search.$el),e.search.setElement(e.search.$el),t.$popup.bottom.empty(),e.pagination&&(e.pagination.render(),t.$popup.bottom.html(e.pagination.$el),e.pagination.setElement(e.pagination.$el))}})})}(jQuery);