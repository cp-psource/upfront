!function(t){upfrontrjs.define([],function(){return Backbone.View.extend({attributes:function(){return{class:"upfront-inline-modal upfront-ui upfront-no-select",id:"upfront-inline-modal-"+this.cid}},initialize:function(t){this.options=t,this.$to=t.to,this.button_text=t.button_text?t.button_text:Upfront.Settings.l10n.global.content.ok,this.button=void 0===t.button||t.button,this.width=void 0!==t.width?t.width:"50%",this.top=void 0!==t.top?t.top:-1,this.left=void 0!==t.left?t.left:-1,this.right=void 0!==t.right?t.right:-1,this.keep_position=void 0===t.keep_position||t.keep_position},events:{click:"on_click","click .upfront-inline-modal-content":"on_click_content","click .upfront-inline-modal-save":"on_click_save"},render:function(){this.$el.html('<div class="upfront-inline-modal-wrap"><div class="upfront-inline-modal-content"></div></div>'),this.$el.hide()},open:function(i,o,e){var n,s,h=this.$el.find(".upfront-inline-modal-wrap"),l=this.$el.find(".upfront-inline-modal-content"),r=t('<button type="button" class="upfront-inline-modal-save">'+this.button_text+"</button>"),d={},p=o&&o.for_view&&o.for_view.$el.hasClass("upfront-region-side-lightbox");return this._deferred=t.Deferred(),this.$el.show(),i.apply(o,[l,this.$el]),e=void 0!==e?e:this.button,e&&r.appendTo(l),d.width=this.width,!p&&this.top>=0?(d.top=this.top,d.bottom="auto"):(s=this.$el.height()>t(window).height()?t(window).height():this.$el.height(),n=l.outerHeight(),this.top=s-n>0?(s-n)/2:0,p&&(this.top=22),d.top=this.top,d.bottom="auto"),this.left>=0?(d.left=this.left,d.right="auto"):this.right>=0&&(d.left="auto",d.width>0&&this.right+d.width<=t(window).width()&&(d.right=this.right,window.innerWidth<1366&&(d.right=d.width))),h.css(d),this.keep_position&&(this.update_pos(),t(window).on("scroll",this,this.on_scroll)),this.trigger("modal:open"),this._deferred.promise()},close:function(i){this.$el.hide(),t(window).off("scroll",this.on_scroll),this.trigger("modal:close"),this._deferred&&(i?this._deferred.resolve(this):this._deferred.reject(this))},on_scroll:function(t){t.data.update_pos()},on_click:function(){this.close(!1)},on_click_content:function(t){t.stopPropagation()},on_click_save:function(){this.close(!0)},update_pos:function(){var i=t(Upfront.Settings.LayoutEditor.Selectors.main);if("none"!=this.$el.css("display")){var o=this.$el.find(".upfront-inline-modal-wrap"),e=this.$to.offset(),n=e.top,s=n+this.$to.outerHeight(),h=t(window).height(),l=t(document).scrollTop(),r=l+h,d=i.offset().top,p=this.$el.offset(),f=p.left+this.$el.width(),c=this.$el.find(".upfront-inline-modal-wrap").outerHeight(),u=n+c;l>=n-d?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:p.left,right:t(window).width()-f}),o.css({top:d+this.top})):(s>u?s:u)+50>r?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:p.left,right:t(window).width()-f}),o.css({top:(s>u?h-(s-n>h?h:s-n)-50:h-c-50)+this.top})):(this.$el.css({position:"",top:"",bottom:"",left:"",right:""}),o.css({top:this.top}))}}})})}(jQuery);