<div <?php if(isset($usingNewAppearance) && $usingNewAppearance === true) { ?>class="<?php echo $preset ?>"<?php } ?>>
    <?php if(isset($usingNewAppearance) && $usingNewAppearance === false) { ?>
    <div class="uimage uimage-<?php echo $caption_position ?> uimage-status-<?php echo $image_status ?> uimage-caption-<?php echo $caption_position ?>-<?php echo $caption_alignment ?><?php echo isset($gifImage) ? $gifImage : '' ?><?php echo isset($stretchClass) ? $stretchClass : '' ?> <?php echo isset($placeholder_class) ? $placeholder_class : '' ?>" style="text-align: <?php echo isset($align) ? $align : '' ?>;">
    <?php } else { ?>
    <div class="upfront-image-wrapper uimage uimage-<?php echo isset($properties['caption-position']) ? $properties['caption-position'] : '' ?> uimage-status-<?php echo isset($image_status) ? $image_status : '' ?> uimage-caption-<?php echo isset($properties['caption-position']) ? $properties['caption-position'] : '' ?>-<?php echo isset($properties['caption-alignment']) ? $properties['caption-alignment'] : '' ?><?php echo isset($gifImage) ? $gifImage : '' ?><?php echo isset($stretchClass) ? $stretchClass : '' ?> <?php echo isset($placeholder_class) ? $placeholder_class : '' ?>" style="text-align: <?php echo isset($align) ? $align : '' ?>;">
    <?php } ?>
        <div class="upfront-image-caption-container" style="margin-top:<?php echo isset($marginTop) ? $marginTop : '' ?>px">
            <?php if(isset($url) && !$in_editor) { ?>
                <a href="<?php echo $url ?>" target="<?php echo isset($link_target) ? $link_target : '' ?>">
            <?php } ?>
            <?php if(isset($src)){ ?>
            <div class="upfront-image-container" <?php if (isset($containerWidth) && $containerWidth) { ?>style="width:<?php echo $containerWidth ?>px;"<?php } ?>>
                <img src="<?php echo $src ?>" alt="<?php echo isset($alternative_text) ? $alternative_text : '' ?>" title="<?php echo isset($image_title) ? $image_title : '' ?>" <?php if(isset($imgWidth) && $imgWidth) { ?>style="width:<?php echo $imgWidth ?>;"<?php } ?>/>
            </div>
            <?php } else { ?>
                <div class="upfront-image-starting_placeholder"><p>Image placeholder</p></div>
            <?php } ?>
    
        <?php if(isset($usingNewAppearance) && $usingNewAppearance !== true) { ?>
            <?php if(isset($include_image_caption) && $include_image_caption) { ?>
                <div class="wp-caption uimage-<?php echo isset($caption_alignment) ? $caption_alignment : '' ?> uimage-<?php echo isset($caption_trigger) ? $caption_trigger : '' ?> uimage-padded-caption" style="background:<?php echo isset($captionBackground) && $captionBackground == '1' ? $background : 'rgba(255, 255, 255, 0)' ?>; ">
                    <?php if(isset($cover_caption) && $cover_caption) { ?>
                    <div class="uimage-caption-cover">
                        <?php } ?>
                        <?php echo isset($image_caption) ? $image_caption : '' ?>
                        <?php if(isset($cover_caption) && $cover_caption) { ?>
                    </div>
                    <?php } ?>
                </div>
            <?php } ?>
        <?php } else { ?>
        <?php if(isset($properties['use_captions']) && !empty($properties['use_captions']) && isset($display_caption) && $display_caption === 'showCaption' )  { ?>
        <div class="wp-caption uimage-<?php echo isset($properties['caption-alignment']) ? $properties['caption-alignment'] : '' ?> uimage-<?php echo isset($properties['caption-trigger']) ? $properties['caption-trigger'] : '' ?> uimage-padded-caption">
            <?php if(isset($cover_caption) && $cover_caption) { ?>
            <div class="uimage-caption-cover">
                <?php } ?>
                <?php echo isset($image_caption) ? $image_caption : '' ?>
                <?php if(isset($cover_caption) && $cover_caption) { ?>
            </div>
            <?php } ?>
        </div>
        <?php } ?>
        <?php } ?>
    
        <?php if(isset($url) && !$in_editor) { ?>
        </a>
        <?php } ?>
    </div>
</div>

<?php if(isset($gifImage) && $gifImage){ ?>
<style>
    #<?php echo isset($element_id) ? $element_id : '' ?> .uimage-gif .upfront-image-container {
        height: <?php echo isset($element_size['height']) ? $element_size['height'] : '' ?>px;
        width: <?php echo isset($element_size['width']) ? $element_size['width'] : '' ?>px;
    }

    #<?php echo isset($element_id) ? $element_id : '' ?> .uimage-gif img {
           height: <?php echo isset($size['height']) ? $size['height'] : '' ?>px;
           width: <?php echo isset($size['width']) ? $size['width'] : '' ?>px !important;
           margin-top: <?php echo isset($gifTop) ? $gifTop : '' ?>;
           margin-left: <?php echo isset($gifLeft) ? $gifLeft : '' ?>;
       }
</style>
<?php } ?>